brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room_category),
iter = 2000, chains = 4, cores = 8,
seed = 5, control = list(adapt_delta = 0.9))
pairs(brm_model2)
brm_model2 <-
brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room_category),
iter = 2000, cores = 8,
seed = 5, control = list(adapt_delta = 0.99))
pairs(brm_model2)
print(brm_model2)
f <-
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)
head(f)
ggplot(aes(x = co2.rescaled, y = Estimate))
ggplot(aes(x = co2.rescaled, y = Estimate))
ggplot(aes(x = co2.rescaled, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
# Note our use of the dot placeholder, here: https://magrittr.tidyverse.org/reference/pipe.html
geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
aes(label = Loc),
hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed divorce",
y = "Predicted divorce") +
theme_bw() +
theme(panel.grid = element_blank())
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
# Note our use of the dot placeholder, here: https://magrittr.tidyverse.org/reference/pipe.html
geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
aes(label = Loc),
hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed divorce",
y = "Predicted divorce") +
theme_bw() +
theme(panel.grid = element_blank())
f <-
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
head(f)
f <-
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = co2.rescaled, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
# Note our use of the dot placeholder, here: https://magrittr.tidyverse.org/reference/pipe.html
geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
aes(label = Loc),
hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed divorce",
y = "Predicted divorce") +
theme_bw() +
theme(panel.grid = element_blank())
f <-
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = co2.rescaled, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
# Note our use of the dot placeholder, here: https://magrittr.tidyverse.org/reference/pipe.html
geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
aes(label = Loc),
hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed divorce",
y = "Predicted divorce") +
theme_bw() +
theme(panel.grid = element_blank())
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = co2.rescaled, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
# Note our use of the dot placeholder, here: https://magrittr.tidyverse.org/reference/pipe.html
geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
aes(label = Loc),
hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed divorce",
y = "Predicted divorce") +
theme_bw() +
theme(panel.grid = element_blank())
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = co2.rescaled, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
#geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
#          aes(label = Loc),
#          hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed divorce",
y = "Predicted divorce") +
theme_bw() +
theme(panel.grid = element_blank())
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = co2.rescaled, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
#geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
#          aes(label = Loc),
#          hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed co2",
y = "Predicted co2") +
theme_bw() +
theme(panel.grid = element_blank())
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = occupancy, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
#geom_text(data = . %>% filter(Loc %in% c("ID", "UT")),
#          aes(label = Loc),
#          hjust = 0, nudge_x = - 0.65) +
labs(x = "Observed co2",
y = "Predicted co2") +
theme_bw() +
theme(panel.grid = element_blank())
model2_stan <- stan_glmer(occupancy ~ 1 + co2.rescaled + (1 | room_category),
data = data,
family=poisson,
adapt_delta = 0.99,
cores = 8,
iter = 2000,
seed = 334)
brm_model2 <-
brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room),
iter = 2000, cores = 8,
seed = 5, control = list(adapt_delta = 0.9999))
install.packages("ggthemes")
brm_model2 <-
brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room),
iter = 2000, cores = 8,
seed = 334, control = list(adapt_delta = 0.9999999))
stanplot(brm_model2)
pairs(brm_model2)
mcmc_plot(brm_model2)
print(brm_model2)
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = occupancy, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
labs(x = "Observed occupancy",
y = "Predicted occupancy") +
theme_bw() +
theme(panel.grid = element_blank())
library(ggthemes)
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room[, , , ,] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room[, , , , ,] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room[, , ,] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room[, , ,,] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room[, ,] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room[, , ]
post_mdn <-
coef(brm_model2, robust = T)$room[, , ,]
post_mdn <-
coef(brm_model2, robust = T)$room[, , ,,]
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
post_mdn %>%
ggplot(aes(x = room)) +
geom_hline(yintercept = inv_logit_scaled(median(post$b_Intercept)), linetype = 2, size = 1/4) +
geom_vline(xintercept = c(16.5, 32.5), size = 1/4) +
geom_point(aes(y = propsurv), color = "orange2") +
geom_point(aes(y = post_mdn), shape = 1) +
coord_cartesian(ylim = c(0, 1)) +
scale_x_continuous(breaks = c(1, 16, 32, 48)) +
labs(title    = "Multilevel shrinkage!",
subtitle = "The empirical proportions are in orange while the model-\nimplied proportions are the black circles. The dashed line is\nthe model-implied average survival proportion.") +
annotate("text", x = c(8, 16 + 8, 32 + 8, 40 + 8, 48 + 8), y = 0,
label = c("Room 1", "Room 2", "Room 3", "Room 4", "Room 5")) +
theme_fivethirtyeight() +
theme(panel.grid = element_blank())
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
post_mdn %>%
ggplot(aes(x = room)) +
geom_hline(yintercept = inv_logit_scaled(median(post$b_Intercept)), linetype = 2, size = 1/4) +
geom_vline(xintercept = c(16.5, 32.5), size = 1/4) +
geom_point(aes(y = propsurv), color = "orange2") +
geom_point(aes(y = post_mdn), shape = 1) +
coord_cartesian(ylim = c(0, 1)) +
scale_x_continuous(breaks = c(1, 16, 32, 48)) +
labs(title    = "Multilevel shrinkage!",
subtitle = "The empirical proportions are in orange while the model-\nimplied proportions are the black circles. The dashed line is\nthe model-implied average survival proportion.") +
annotate("text", x = c(8, 16 + 8, 32 + 8, 40 + 8, 48 + 8), y = 0,
label = c("Room 1", "Room 2", "Room 3", "Room 4", "Room 5")) +
theme_fivethirtyeight() +
theme(panel.grid = element_blank())
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble()
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
bind_cols(data)
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
bind_cols(data)
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
bind_cols(5) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
data %>%
glimpse()
brm_model2 <-
brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room_category),
iter = 2000, cores = 8,
seed = 334, control = list(adapt_delta = 0.9999999, max_treedepth=20))
mcmc_plot(brm_model2)
pairs(brm_model2)
print(brm_model2)
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = occupancy, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
labs(x = "Observed occupancy",
y = "Predicted occupancy") +
theme_bw() +
theme(panel.grid = element_blank())
library(ggthemes)
post_mdn <-
coef(brm_model2, robust = T)$room[, , ] %>%
as_tibble() %>%
bind_cols(5) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
data %>%
glimpse()
post_mdn <-
coef(brm_model2, robust = T)$room_category[, , ] %>%
as_tibble() %>%
bind_cols(5) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$room_category[, , ] %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
bind_cols(data)
as_tibble() %>%
bind_cols(data
)
coef(brm_model2, robust = T)$room_category[, , ] %>%
as_tibble() %>%
bind_cols(data) %>%
coef(brm_model2, robust = T)$room_category[, , ] %>%
as_tibble() %>%
bind_cols(data)
coef(brm_model2, robust = T)$room_category[, , ]
coef(brm_model2, robust = T)
coef(brm_model2, robust = T)$room_category
post_mdn <-
coef(brm_model2, robust = T)$room_category %>%
as_tibble() %>%
bind_cols(data) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
library(rethinking)
data(reedfrogs)
d <- reedfrogs
rm(reedfrogs)
detach(package:rethinking, unload = T)
library(brms)
d %>%
glimpse()
data %>%
glimpse()
d <-
d %>%
mutate(tank = 1:nrow(d))
d
data_numbered <-
data %>%
mutate(tank = 1:nrow(data))
data_numbered
data %>%
glimpse()
data_numbered <-
data %>%
mutate(tank = 1:nrow(data))
post_mdn <-
coef(brm_model2, robust = T)$room_category[, , ] %>%
as_tibble() %>%
bind_cols(data_numbered) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
post_mdn <-
coef(brm_model2, robust = T)$tank[, , ] %>%
as_tibble() %>%
bind_cols(data_numbered) %>%
mutate(post_mdn = inv_logit_scaled(Estimate))
tank_model <-
brm(data = data_numbered, family = poisson,
co2.rescaled | trials(room_category) ~ 1 + (1 | tank),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 1), class = sd)),
iter = 4000, warmup = 1000, chains = 4, cores = 4,
seed = 12)
tank_model <-
brm(data = data_numbered, family = binomial,
co2.rescaled | trials(room_category) ~ 1 + (1 | tank),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 1), class = sd)),
iter = 4000, warmup = 1000, chains = 4, cores = 4,
seed = 12)
tank_model <-
brm(data = data_numbered, family = binomial,
co2 | trials(room_category) ~ 1 + (1 | tank),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 1), class = sd)),
iter = 4000, warmup = 1000, chains = 4, cores = 4,
seed = 12)
tank_model <-
brm(data = data_numbered, family = binomial,
co2 | trials(room_category) ~ 1 + (1 | tank),
iter = 4000, warmup = 1000, chains = 4, cores = 4,
seed = 12)
tank_model <-
brm(data = data_numbered, family = binomial,
as.integer(co2) | trials(room_category) ~ 1 + (1 | tank),
prior = c(prior(normal(0, 1), class = Intercept),
prior(cauchy(0, 1), class = sd)),
iter = 4000, warmup = 1000, chains = 4, cores = 4,
seed = 12)
library(rstanarm)
install.packages("rstan")
install.packages("rstan")
install.packages("rstan")
Sys.setenv(MAKEFLAGS = paste0("-j", parallel::detectCores()))
install.packages("pkgbuild", INSTALL_opts = "--no-multiarch")
cat("Rtools version 4.0.0", file = file.path("C:", "rtools40", "VERSION.txt"), sep = "\n")
cat("Rtools 4.0", file = file.path("C:", "rtools40", "Rtools.txt"), sep = "\n")
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE, INSTALL_opts = "--no-multiarch")
options(mc.cores = parallel::detectCores())
rstan::rstan_options(auto_write = TRUE)
devtools::install_github('IRkernel/IRkernel')
install.packages(c('repr', 'IRdisplay', 'evaluate', 'crayon', 'pbdZMQ', 'devtools', 'uuid', 'digest'))
install.packages(c("repr", "IRdisplay", "evaluate", "crayon", "pbdZMQ", "devtools", "uuid", "digest"))
install.packages(c("repr", "IRdisplay", "evaluate", "crayon", "pbdZMQ", "devtools", "uuid", "digest"))
devtools::install_github('IRkernel/IRkernel')
IRkernel::installspec(user = FALSE)
jupyter kernelspec --version
library(rstanarm)
library(lme4)
library(ggplot2)
library(scales)
library(shinystan)
library(lubridate)
library(rethinking)
Sys.setenv("MC_CORES"= 8)
Sys.getenv("MC_CORES")
getOption("mc.cores", 8)
setwd("C:/Users/mam/PycharmProjects/SmartBuldings/Hierarchical models")
data = read.csv("data_co2_occ_num.csv")
colnames(data)[colnames(data) == 'sensor_name'] <- 'room'
summary(data)
data$co2.rescaled <- rescale(data$co2)
data$log_co2 <- scale(log(data$co2))
data$room_category = unclass(data$room)
data$day_of_the_week <- factor(weekdays(as.Date(data$X)))
data$day_of_the_week_category = unclass(data$day_of_the_week)
data$time<-format(strptime(data$X, "%Y-%m-%d %H:%M:%S"), "%H:%M:%S")
breaks <- hour(hm("00:00", "6:00", "12:00", "16:00", "23:59"))
labels <- c("Night", "Morning", "Afternoon", "Evening")
data$time_cat <- cut(x=hour(data$X), breaks = breaks, labels = labels, include.lowest=TRUE)
train_index <- sample(1:nrow(data), 0.75 * nrow(data))
test_index <- setdiff(1:nrow(data), train_index)
# Build X_train, y_train, X_test, y_test
X_train <- data[train_index, -15]
brm_model2 <-
brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room_category),
iter = 2000, cores = 8,
seed = 334, control = list(adapt_delta = 0.9999999, max_treedepth=20))
mcmc_plot(brm_model2)
pairs(brm_model2)
print(brm_model2)
fitted(brm_model2) %>%
as_tibble() %>%
bind_cols(data)  %>%
ggplot(aes(x = occupancy, y = Estimate)) +
geom_abline(linetype = 2, color = "grey50", size = .5) +
geom_point(size = 1.5, color = "firebrick4", alpha = 3/4) +
geom_linerange(aes(ymin = Q2.5, ymax = Q97.5),
size = 1/4, color = "firebrick4") +
geom_linerange(aes(ymin = Estimate - Est.Error,
ymax = Estimate + Est.Error),
size = 1/2, color = "firebrick4") +
labs(x = "Observed occupancy",
y = "Predicted occupancy") +
theme_bw() +
theme(panel.grid = element_blank())
library(ggthemes)
data %>%
glimpse()
detach(package:rethinking, unload = T)
library(brms)
library(tidyverse)
brm_model2 <-
brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room_category),
iter = 2000, cores = 8,
seed = 334, control = list(adapt_delta = 0.9999999, max_treedepth=20))
install.packages("rstan")
detach(package:rethinking, unload = T)
library(brms)
library(tidyverse)
brm_model2 <-
brm(data = data, family = poisson,
occupancy ~ 1 + co2.rescaled + (1 | room_category),
iter = 2000, cores = 8,
seed = 334, control = list(adapt_delta = 0.9999999, max_treedepth=20))
